# 组合模式

```
定义：
    将对象组合成树形结构以表示“部分-整体”的层次结构。
    组合模式使得用户对单个对象和嘴和对象的使用具有一致性。

组合模式的目的：
    让客户端不再区分操作的是组合对象还是叶子对象，
    而是以一个统一的方式来操作。
    实现这个目标的关键之处是设计一个抽象的组件类。让它可以代表组合对象和叶子对象，这样客户端不用区分，只需全部当成组件对象进行统一的操作即可。
    
对象树：
    通常，组合模式会组合出树形结构来，组成这个树形结构所使用的多个组件对象，就自然的形成了对象树。
    凡是可以使用对象树来描述或操作的功能，都可以考虑使用组合模式，比如XML文件或是对语句进行语法解析等。
    
组合模式中的递归：
    指的是对象递归组合，而不是常说的递归算法。
    组合模式的递归是对象本身的递归，是对象的组合方式，从设计上来讲的，在设计上称作递归关联，是对象关联关系的一种。

最大化Compoent定义：
    因为组合对象要统一两种对象的操作，所以Component里面的方法也主要是两种对象对外方法的和。
    这种实现和类的设计原则相冲突，类的设计有这样的原则：一个父类应该只定义那些对它的子类有意义的操作。
    常见的解决冲突的方法是在Component提高默认的实现，或者是默认抛出不支持该功能的例外。如果子类对象需要这个功能就覆盖实现，如果不需要则不管。

子部件排序：
    某些应用中，使用组合模式的时候，需要按照一定的顺序来使用子对象，比如进行语法分析的时候，使用组合模式构建的抽象语法树，在解析的时候是需要按照顺序来执行的。
    需要在设计的时候，就把组件对象的索引考虑进去，并仔细的设计对子节点的访问和管理接口，通常的方式是需要按照顺序来存储，这样在获取的时候就可以按照顺序得到了。
    可以考虑结合Iterator模式来实现按照顺序的访问组件对象。

安全性和透明性：
    安全性：从客户使用组合模式上看是否更安全。如果是安全的，那么不会有发生误操作的可能，能访问的方法都是被支持的功能。
    透明性：从客户使用组合模式上，是否需要区分到底是组合对象还是叶子对象。如果是透明的，就不再区分，对客户而已都是组件对象，具体的类型对于客户而已是透明的，客户无须关心。
    
两种实现方式的选择：
    因为安全性和透明性相冲突，所以需要选择。
    对于组合模式而言，在安全性和透明性上，会更看重透明性，毕竟组合模式的功能就是要让用户对叶子对象和组合对象的使用具有一致性。
    而且对于安全性的实现，需要区分是组合对象还是叶子对象，但是有时候，需要将对象进行类型转换，但是发现类型信息丢失，只好强转，这种转换必然是不够安全的。
    对于这种情况的处理方法是在Component里面定义一个getComposite方法，用来判断是组合对象还是叶子对象，如果是组合对象直接返回组合对象，
    如果是叶子对象，就返回null，这样就可以先判断再强转。
    建议，多用透明实现，少用安全实现。

父组件引用：子组件对象到父组件对象的引用。
    较为简单的方案是在保持从父组件到子组件的引用基础上再增加保持从子组件到父组件的引用。
    这样在删除一个组件对象或者调整一个组件对象的时候，可以通过调整父组件的引用来实现吗，这可以大大简化实现。
    通常会在Component中定义对父组件的引用，组合对象和叶子对象都可以继承这个引用。
    在组合对象添加子组件的时候，为子组件对象设置父组件的引用。

环状引用：
    在对象结构中，某个对象包含的子对象，或者是子对象的子对象...如此经过N层后，出现所包含的子对象中有这个对象本身，从而构成了环状引用。
    检测方式：
        简单思路：记录下每个组件从根节点开始的路径，因为要出现环状引用，一条路径上，某个对象就必然会出现两次。
        
组合模式的优缺点：
    1、定义了包含基本对象和组合对象的类层次结构
    2、统一了组合对象和叶子对象
    3、简化了客户端的调用
    4、更容易扩展
    5、很难限制组合中的组件类型

组合模式的本质：统一叶子对象和组合对象

何时选用：
    1、想表示对象的部分-整体层次结构，可以选用组合模式，把整体和部分的操作统一起来，是的层次结构实现更简单，从外部来使用这个层次结构也简单。
    2、希望统一的使用组合结构中的所有对象，可以选用组合模式，这正是组合模式提高的主要功能。



```



